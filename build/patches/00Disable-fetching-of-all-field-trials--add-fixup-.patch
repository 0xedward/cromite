From: Your Name <you@example.com>
Date: Wed, 19 Oct 2022 13:25:14 +0000
Subject: Disable fetching of all field trials (add fixup)

---
 chrome/browser/net/system_network_context_manager.cc  | 1 -
 components/variations/net/BUILD.gn                    | 2 --
 content/browser/loader/url_loader_throttles.cc        | 2 --
 content/browser/origin_trials/origin_trials_utils.cc  | 2 +-
 content/public/common/content_features.cc             | 4 ++--
 content/renderer/variations_render_thread_observer.cc | 9 ---------
 6 files changed, 3 insertions(+), 17 deletions(-)

diff --git a/chrome/browser/net/system_network_context_manager.cc b/chrome/browser/net/system_network_context_manager.cc
--- a/chrome/browser/net/system_network_context_manager.cc
+++ b/chrome/browser/net/system_network_context_manager.cc
@@ -707,7 +707,6 @@ void SystemNetworkContextManager::AddSSLConfigToNetworkContextParams(
 
 void SystemNetworkContextManager::ConfigureDefaultNetworkContextParams(
     network::mojom::NetworkContextParams* network_context_params) {
-  variations::UpdateCorsExemptHeaderForVariations(network_context_params);
 
   network_context_params->enable_brotli = true;
 
diff --git a/components/variations/net/BUILD.gn b/components/variations/net/BUILD.gn
--- a/components/variations/net/BUILD.gn
+++ b/components/variations/net/BUILD.gn
@@ -33,8 +33,6 @@ static_library("net") {
   # third_party/blink/public/common does not build on iOS
   if (!is_ios) {
     sources += [
-      "variations_url_loader_throttle.cc",
-      "variations_url_loader_throttle.h",
     ]
     deps += [
       "//components/variations:variations_mojom",
diff --git a/content/browser/loader/url_loader_throttles.cc b/content/browser/loader/url_loader_throttles.cc
--- a/content/browser/loader/url_loader_throttles.cc
+++ b/content/browser/loader/url_loader_throttles.cc
@@ -47,8 +47,6 @@ CreateContentBrowserURLLoaderThrottles(
   // TODO(crbug.com/1094303): Consider whether we want to use the WebContents to
   // determine the value for variations::Owner. Alternatively, this is the
   // browser side, and we might be fine with Owner::kUnknown.
-  variations::VariationsURLLoaderThrottle::AppendThrottleIfNeeded(
-      browser_context->GetVariationsClient(), &throttles);
 
   ClientHintsControllerDelegate* client_hint_delegate =
       browser_context->GetClientHintsControllerDelegate();
diff --git a/content/browser/origin_trials/origin_trials_utils.cc b/content/browser/origin_trials/origin_trials_utils.cc
--- a/content/browser/origin_trials/origin_trials_utils.cc
+++ b/content/browser/origin_trials/origin_trials_utils.cc
@@ -14,7 +14,7 @@ namespace {
 std::vector<std::string> GetHeaderValues(
     base::StringPiece header_name,
     const net::HttpResponseHeaders* headers) {
-  if (!headers) {
+  if ((true)) {
     return {};
   }
   size_t iter = 0;
diff --git a/content/public/common/content_features.cc b/content/public/common/content_features.cc
--- a/content/public/common/content_features.cc
+++ b/content/public/common/content_features.cc
@@ -784,8 +784,8 @@ BASE_FEATURE(kPepperCrossOriginRedirectRestriction,
 // things before receiving the response, for instance it can affect the next
 // navigation's network request.
 BASE_FEATURE(kPersistentOriginTrials,
-             "PersistentOriginTrials",
-             base::FEATURE_DISABLED_BY_DEFAULT);
+             "PersistentOriginTrials",            // always disabled
+             base::FEATURE_DISABLED_BY_DEFAULT);  // in bromite
 
 // Enables process sharing for sites that do not require a dedicated process
 // by using a default SiteInstance. Default SiteInstances will only be used
diff --git a/content/renderer/variations_render_thread_observer.cc b/content/renderer/variations_render_thread_observer.cc
--- a/content/renderer/variations_render_thread_observer.cc
+++ b/content/renderer/variations_render_thread_observer.cc
@@ -56,15 +56,6 @@ void VariationsRenderThreadObserver::AppendThrottleIfNeeded(
     const url::Origin& top_frame_origin,
     std::vector<std::unique_ptr<blink::URLLoaderThrottle>>* throttles) {
   variations::OmniboxURLLoaderThrottle::AppendThrottleIfNeeded(throttles);
-
-  variations::mojom::VariationsHeadersPtr variations_headers =
-      GetVariationsData()->GetVariationsHeaders();
-
-  if (!variations_headers.is_null()) {
-    throttles->push_back(
-        std::make_unique<variations::VariationsURLLoaderThrottle>(
-            std::move(variations_headers), top_frame_origin));
-  }
 }
 
 void VariationsRenderThreadObserver::RegisterMojoInterfaces(
--
2.25.1
