From: Your Name <you@example.com>
Date: Wed, 12 Oct 2022 14:03:37 +0000
Subject: WIN ADDTO JIT site settings

---
 chrome/app/settings_strings.grdp              | 19 ++++++++++++++++
 chrome/browser/resources/settings/icons.html  |  2 ++
 .../settings/privacy_page/privacy_page.html   | 22 +++++++++++++++++++
 chrome/browser/resources/settings/route.ts    |  1 +
 chrome/browser/resources/settings/router.ts   |  1 +
 .../site_settings/category_default_setting.ts |  1 +
 .../settings/site_settings/constants.ts       |  1 +
 .../settings_category_default_radio_group.ts  |  1 +
 .../settings/site_settings/site_details.html  |  5 +++++
 .../site_settings_page/site_settings_page.ts  |  9 ++++++++
 .../site_settings_page_util.ts                |  2 ++
 .../views/page_info/page_info_view_factory.cc |  3 +++
 .../settings_localized_strings_provider.cc    |  7 ++++++
 .../ui/webui/settings/site_settings_helper.cc |  3 ++-
 .../core/browser/content_settings_registry.cc |  3 ++-
 15 files changed, 78 insertions(+), 2 deletions(-)

diff --git a/chrome/app/settings_strings.grdp b/chrome/app/settings_strings.grdp
--- a/chrome/app/settings_strings.grdp
+++ b/chrome/app/settings_strings.grdp
@@ -4240,6 +4240,25 @@
     Not allowed to autoplay
   </message>
 
+  <message name="IDS_SITE_SETTINGS_JAVASCRIPT_JIT_TITLE" desc="Description of the Javascript JIT content setting page title.">
+    Javascript JIT
+  </message>
+  <message name="IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_DESCRIPTION" desc="Description of the Javascript JIT content setting.">
+    Enable the JIT compiler in V8
+  </message>
+  <message name="IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_ALLOWED" desc="Label for the enabled option of the Javascript JIT setting.">
+    Javascript JIT is enabled
+  </message>
+  <message name="IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_BLOCKED" desc="Label for the disabled option of the Javascript JIT setting.">
+    Javascript JIT is disabled
+  </message>
+  <message name="IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_ALLOWED_EXCEPTIONS" desc="Label for the allowed exceptions site list of the Javascript JIT setting.">
+    Allowed to Javascript JIT
+  </message>
+  <message name="IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_BLOCKED_EXCEPTIONS" desc="Label for the blocked exceptions site list of the Javascript JIT setting.">
+    Not allowed to Javascript JIT
+  </message>
+
   <if expr="not is_chromeos">
     <!-- Import Settings Dialog -->
     <message name="IDS_SETTINGS_IMPORT_SETTINGS_TITLE" desc="Dialog title for import dialog.">
diff --git a/chrome/browser/resources/settings/icons.html b/chrome/browser/resources/settings/icons.html
--- a/chrome/browser/resources/settings/icons.html
+++ b/chrome/browser/resources/settings/icons.html
@@ -191,6 +191,8 @@ NOTE: Chrome OS icons go in ./chromeos/os_icons.html.
       <g id="feedback" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17l-.59.59-.58.58V4h16v12zm-9-4h2v2h-2zm0-6h2v4h-2z"></path></g>
       <g id="autoplay"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></g>
       <g id="autoplay-off"><path d="M16.25,13.42C16.4,12.97,16.5,12.5,16.5,12c0-1.77-1.02-3.29-2.5-4.03v3.2L16.25,13.42z"></path><path d="M19,12c0,1.21-0.31,2.34-0.85,3.32l1.46,1.46C20.48,15.39,21,13.76,21,12c0-4.28-2.99-7.86-7-8.77v2.06 C16.89,6.15,19,8.83,19,12z"></path><path d="M2.81,2.81L1.39,4.22L6.17,9H3v6h4l5,5v-5.17l3.32,3.32c-0.42,0.23-0.85,0.43-1.32,0.56v2.06c1-0.23,1.94-0.62,2.79-1.15 l2.99,2.99l1.41-1.41L2.81,2.81z"></path><polygon points="12,9.17 12,4 9.41,6.59"></polygon></g>
+      <g id="javascript-jit"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></g>
+      <g id="javascript-jit-off"><path d="M19.17,12l-4.58-4.59L16,6l6,6l-3.59,3.59L17,14.17L19.17,12z M1.39,4.22l4.19,4.19L2,12l6,6l1.41-1.41L4.83,12L7,9.83 l12.78,12.78l1.41-1.41L2.81,2.81L1.39,4.22z"></path></g>
     </defs>
   </svg>
 </iron-iconset-svg>
diff --git a/chrome/browser/resources/settings/privacy_page/privacy_page.html b/chrome/browser/resources/settings/privacy_page/privacy_page.html
--- a/chrome/browser/resources/settings/privacy_page/privacy_page.html
+++ b/chrome/browser/resources/settings/privacy_page/privacy_page.html
@@ -1125,4 +1125,26 @@
           </category-setting-exceptions>
         </settings-subpage>
       </template>
+      <template is="dom-if" route-path="/content/javascript-jit" no-search>
+        <settings-subpage page-title="$i18n{siteSettingsJavascriptJIT}"
+            search-label="$i18n{siteSettingsAllSitesSearch}"
+            search-term="{{searchFilter_}}">
+          <div class="content-settings-header secondary">
+            $i18n{siteSettingsJavascriptJITDescription}
+          </div>
+          <settings-category-default-radio-group
+              category="[[contentSettingsTypesEnum_.JAVASCRIPT_JIT]]"
+              allow-option-label="$i18n{siteSettingsJavascriptJITAllowed}"
+              allow-option-icon="settings:javascript-jit"
+              block-option-label="$i18n{siteSettingsJavascriptJITBlocked}"
+              block-option-icon="settings:javascript-jit-off">
+          </settings-category-default-radio-group>
+          <category-setting-exceptions
+              category="[[contentSettingsTypesEnum_.JAVASCRIPT_JIT]]"
+              block-header="$i18n{siteSettingsJavascriptJITBlockedExceptions}"
+              allow-header="$i18n{siteSettingsJavascriptJITAllowedExceptions}"
+              search-filter="[[searchFilter_]]">
+          </category-setting-exceptions>
+        </settings-subpage>
+      </template>
     </settings-animated-pages>
diff --git a/chrome/browser/resources/settings/route.ts b/chrome/browser/resources/settings/route.ts
--- a/chrome/browser/resources/settings/route.ts
+++ b/chrome/browser/resources/settings/route.ts
@@ -115,6 +115,7 @@ function addPrivacyChildRoutes(r: Partial<SettingsRoutes>) {
   r.SITE_SETTINGS_FILE_SYSTEM_WRITE = r.SITE_SETTINGS.createChild('filesystem');
   r.SITE_SETTINGS_LOCAL_FONTS = r.SITE_SETTINGS.createChild('localFonts');
   r.SITE_SETTINGS_AUTOPLAY = r.SITE_SETTINGS.createChild('autoplay');
+  r.SITE_SETTINGS_JAVASCRIPT_JIT = r.SITE_SETTINGS.createChild('javascript-jit');
 }
 
 /**
diff --git a/chrome/browser/resources/settings/router.ts b/chrome/browser/resources/settings/router.ts
--- a/chrome/browser/resources/settings/router.ts
+++ b/chrome/browser/resources/settings/router.ts
@@ -102,6 +102,7 @@ export interface SettingsRoutes {
   SYSTEM: Route;
   TRIGGERED_RESET_DIALOG: Route;
   SITE_SETTINGS_AUTOPLAY: Route;
+  SITE_SETTINGS_JAVASCRIPT_JIT: Route;
 }
 
 /** Class for navigable routes. */
diff --git a/chrome/browser/resources/settings/site_settings/category_default_setting.ts b/chrome/browser/resources/settings/site_settings/category_default_setting.ts
--- a/chrome/browser/resources/settings/site_settings/category_default_setting.ts
+++ b/chrome/browser/resources/settings/site_settings/category_default_setting.ts
@@ -196,6 +196,7 @@ export class CategoryDefaultSettingElement extends
       case ContentSettingsTypes.SENSORS:
       case ContentSettingsTypes.SOUND:
       case ContentSettingsTypes.AUTOPLAY:
+      case ContentSettingsTypes.JAVASCRIPT_JIT:
         // "Allowed" vs "Blocked".
         this.browserProxy.setDefaultValueForContentType(
             this.category,
diff --git a/chrome/browser/resources/settings/site_settings/constants.ts b/chrome/browser/resources/settings/site_settings/constants.ts
--- a/chrome/browser/resources/settings/site_settings/constants.ts
+++ b/chrome/browser/resources/settings/site_settings/constants.ts
@@ -47,6 +47,7 @@ export enum ContentSettingsTypes {
   WINDOW_MANAGEMENT = 'window-placement',
   ZOOM_LEVELS = 'zoom-levels',
   AUTOPLAY = 'autoplay',
+  JAVASCRIPT_JIT = 'javascript-jit',
 
   // The following items are not in the C++ kContentSettingsTypeGroupNames, but
   // are used everywhere where ContentSettingsTypes is used in JS.
diff --git a/chrome/browser/resources/settings/site_settings/settings_category_default_radio_group.ts b/chrome/browser/resources/settings/site_settings/settings_category_default_radio_group.ts
--- a/chrome/browser/resources/settings/site_settings/settings_category_default_radio_group.ts
+++ b/chrome/browser/resources/settings/site_settings/settings_category_default_radio_group.ts
@@ -140,6 +140,7 @@ export class SettingsCategoryDefaultRadioGroupElement extends
       case ContentSettingsTypes.SENSORS:
       case ContentSettingsTypes.SOUND:
       case ContentSettingsTypes.AUTOPLAY:
+      case ContentSettingsTypes.JAVASCRIPT_JIT:
         // "Allowed" vs "Blocked".
         return ContentSetting.ALLOW;
       case ContentSettingsTypes.AR:
diff --git a/chrome/browser/resources/settings/site_settings/site_details.html b/chrome/browser/resources/settings/site_settings/site_details.html
--- a/chrome/browser/resources/settings/site_settings/site_details.html
+++ b/chrome/browser/resources/settings/site_settings/site_details.html
@@ -271,4 +271,9 @@
           icon="settings:federated-identity-api"
           label="$i18n{siteSettingsFederatedIdentityApi}">
       </site-details-permission>
+      <site-details-permission
+          category="[[contentSettingsTypesEnum_.JAVASCRIPT_JIT]]"
+          icon="settings:javascript-jit"
+          label="$i18n{siteSettingsJavascriptJIT}">
+      </site-details-permission>
     </div>
diff --git a/chrome/browser/resources/settings/site_settings_page/site_settings_page.ts b/chrome/browser/resources/settings/site_settings_page/site_settings_page.ts
--- a/chrome/browser/resources/settings/site_settings_page/site_settings_page.ts
+++ b/chrome/browser/resources/settings/site_settings_page/site_settings_page.ts
@@ -342,6 +342,14 @@ function getCategoryItemMap(): Map<ContentSettingsTypes, CategoryListItem> {
       enabledLabel: 'siteSettingsAutoplayAllowed',
       disabledLabel: 'siteSettingsAutoplayBlocked',
     },
+    {
+      route: routes.SITE_SETTINGS_JAVASCRIPT_JIT,
+      id: Id.JAVASCRIPT_JIT,
+      label: 'siteSettingsJavascriptJIT',
+      icon: 'settings:javascript-jit',
+      enabledLabel: 'siteSettingsJavascriptJITAllowed',
+      disabledLabel: 'siteSettingsJavascriptJITBlocked',
+    },
   ];
 
   categoryItemMap = new Map(categoryList.map(item => [item.id, item]));
@@ -436,6 +444,7 @@ export class SettingsSiteSettingsPageElement extends
               Id.FEDERATED_IDENTITY_API,
               Id.SITE_DATA,
               Id.AUTOPLAY,
+              Id.JAVASCRIPT_JIT,
             ]),
           };
         },
diff --git a/chrome/browser/resources/settings/site_settings_page/site_settings_page_util.ts b/chrome/browser/resources/settings/site_settings_page/site_settings_page_util.ts
--- a/chrome/browser/resources/settings/site_settings_page/site_settings_page_util.ts
+++ b/chrome/browser/resources/settings/site_settings_page/site_settings_page_util.ts
@@ -79,6 +79,8 @@ export function getLocalizationStringForContentType(
       return 'siteSettingsZoomLevelsMidSentence';
     case ContentSettingsTypes.AUTOPLAY:
       return 'siteSettingsAutoplayMidSentence';
+    case ContentSettingsTypes.JAVASCRIPT_JIT:
+      return 'siteSettingsJavascriptJITMidSentence';
     // The following members do not have a mid-sentence localization.
     case ContentSettingsTypes.ANTI_ABUSE:
     case ContentSettingsTypes.PDF_DOCUMENTS:
diff --git a/chrome/browser/ui/views/page_info/page_info_view_factory.cc b/chrome/browser/ui/views/page_info/page_info_view_factory.cc
--- a/chrome/browser/ui/views/page_info/page_info_view_factory.cc
+++ b/chrome/browser/ui/views/page_info/page_info_view_factory.cc
@@ -341,6 +341,9 @@ const ui::ImageModel PageInfoViewFactory::GetPermissionIcon(
     case ContentSettingsType::AUTOPLAY:
       icon = &vector_icons::kProtectedContentIcon;
       break;
+    case ContentSettingsType::JAVASCRIPT_JIT:
+      icon = &vector_icons::kCodeIcon;
+      break;
     default:
       // All other |ContentSettingsType|s do not have icons on desktop or are
       // not shown in the Page Info bubble.
diff --git a/chrome/browser/ui/webui/settings/settings_localized_strings_provider.cc b/chrome/browser/ui/webui/settings/settings_localized_strings_provider.cc
--- a/chrome/browser/ui/webui/settings/settings_localized_strings_provider.cc
+++ b/chrome/browser/ui/webui/settings/settings_localized_strings_provider.cc
@@ -2427,6 +2427,13 @@ void AddSiteSettingsStrings(content::WebUIDataSource* html_source,
     {"siteSettingsAutoplayAllowedExceptions",IDS_SETTINGS_SITE_SETTINGS_AUTOPLAY_ALLOWED_EXCEPTIONS},
     {"siteSettingsAutoplayBlockedExceptions", IDS_SETTINGS_SITE_SETTINGS_AUTOPLAY_BLOCKED_EXCEPTIONS},
     {"siteSettingsAutoplayMidSentence", IDS_SITE_SETTINGS_TYPE_AUTOPLAY},
+    {"siteSettingsJavascriptJIT", IDS_SITE_SETTINGS_JAVASCRIPT_JIT_TITLE},
+    {"siteSettingsJavascriptJITDescription", IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_DESCRIPTION},
+    {"siteSettingsJavascriptJITAllowed", IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_ALLOWED},
+    {"siteSettingsJavascriptJITBlocked", IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_BLOCKED},
+    {"siteSettingsJavascriptJITAllowedExceptions",IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_ALLOWED_EXCEPTIONS},
+    {"siteSettingsJavascriptJITBlockedExceptions", IDS_SETTINGS_SITE_SETTINGS_JAVASCRIPT_JIT_BLOCKED_EXCEPTIONS},
+    {"siteSettingsJavascriptJITMidSentence", IDS_SITE_SETTINGS_TYPE_JAVASCRIPT_JIT},
     {"addSite", IDS_SETTINGS_ADD_SITE},
     {"addSiteTitle", IDS_SETTINGS_ADD_SITE_TITLE},
 #if BUILDFLAG(IS_CHROMEOS_ASH)
diff --git a/chrome/browser/ui/webui/settings/site_settings_helper.cc b/chrome/browser/ui/webui/settings/site_settings_helper.cc
--- a/chrome/browser/ui/webui/settings/site_settings_helper.cc
+++ b/chrome/browser/ui/webui/settings/site_settings_helper.cc
@@ -126,6 +126,7 @@ const ContentSettingsTypeNameEntry kContentSettingsTypeGroupNames[] = {
      "private-network-devices-data"},
     {ContentSettingsType::ANTI_ABUSE, "anti-abuse"},
     {ContentSettingsType::AUTOPLAY, "autoplay"},
+    {ContentSettingsType::JAVASCRIPT_JIT, "javascript-jit"},
 
     // Add new content settings here if a corresponding Javascript string
     // representation for it is not required, for example if the content setting
@@ -162,7 +163,6 @@ const ContentSettingsTypeNameEntry kContentSettingsTypeGroupNames[] = {
     {ContentSettingsType::FILE_SYSTEM_LAST_PICKED_DIRECTORY, nullptr},
     {ContentSettingsType::DISPLAY_CAPTURE, nullptr},
     {ContentSettingsType::FEDERATED_IDENTITY_SHARING, nullptr},
-    {ContentSettingsType::JAVASCRIPT_JIT, nullptr},
     {ContentSettingsType::HTTP_ALLOWED, nullptr},
     {ContentSettingsType::FORMFILL_METADATA, nullptr},
     {ContentSettingsType::FEDERATED_IDENTITY_ACTIVE_SESSION, nullptr},
@@ -460,6 +460,7 @@ const std::vector<ContentSettingsType>& GetVisiblePermissionCategories() {
     }
 
     base_types->push_back(ContentSettingsType::AUTOPLAY);
+    base_types->push_back(ContentSettingsType::JAVASCRIPT_JIT);
 
     initialized = true;
   }
diff --git a/components/content_settings/core/browser/content_settings_registry.cc b/components/content_settings/core/browser/content_settings_registry.cc
--- a/components/content_settings/core/browser/content_settings_registry.cc
+++ b/components/content_settings/core/browser/content_settings_registry.cc
@@ -511,7 +511,8 @@ void ContentSettingsRegistry::Init() {
            ContentSettingsInfo::EXCEPTIONS_ON_SECURE_ORIGINS_ONLY);
 
   Register(ContentSettingsType::JAVASCRIPT_JIT, "javascript-jit",
-           CONTENT_SETTING_BLOCK, WebsiteSettingsInfo::UNSYNCABLE,
+           CONTENT_SETTING_BLOCK,
+           WebsiteSettingsInfo::UNSYNCABLE,
            /*allowlisted_schemes=*/{},
            /*valid_settings=*/{CONTENT_SETTING_ALLOW, CONTENT_SETTING_BLOCK},
            WebsiteSettingsInfo::TOP_ORIGIN_ONLY_SCOPE,
--
2.25.1
